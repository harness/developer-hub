---
title: Set up impression integration to AWS S3 using AWS Kinesis Firehose
sidebar_label: Set up impression integration to AWS S3 using AWS Kinesis Firehose
helpdocs_is_private: false
helpdocs_is_published: true
---

<p>
  <button hidden style={{borderRadius:'8px', border:'1px', fontFamily:'Courier New', fontWeight:'800', textAlign:'left'}}> help.split.io link: https://help.split.io/hc/en-us/articles/360035888432-How-to-Setup-Impression-Integration-To-AWS-S3-using-AWS-Kinesis-Stream-Firehose-and-Lambda-Cloud-Services <br /> âœ˜ images still hosted on help.split.io </button>
</p>

<p>
  This article shows step by step how to setup all the AWS cloud serverless components
  to store the Split impressions data in AWS S3 in JSON format
</p>
<p>
  Split Admin site provide a webhook integration option to send the Impression
  data as they are injected into Split cloud, we will use the webhook to extract
  Impression data.
</p>
<p>
  We will also use AWS API Gateway as the Webhook service, the API Gateway will
  forward the post request to AWS Lambda, which will extract the Impression information
  and send it to AWS Kinesis Firehose which has a built-in integration with S3.
</p>
<p>Here are the steps to setup the integration:</p>
<p>
  1. First step is to create the Kinesis Firehose service, login to AWS and select
  <strong>Services-&gt;Kinesis-&gt;Data Firehose.</strong>
</p>
<p>
  2. Put the service name, make sure
  <strong>Direct PUT or other sources</strong>&nbsp;option is set and click
  <strong>Next.</strong>
</p>
<p>
  <strong><img src="https://help.split.io/hc/article_attachments/360042903931/Screen_Shot_2019-11-12_at_2.14.49_PM.png" alt="Screen_Shot_2019-11-12_at_2.14.49_PM.png" /></strong>
</p>
<p>
  3. Click <strong>Next</strong>&nbsp;again into the
  <strong>Select a destination</strong>&nbsp;page, make sure <strong>S3</strong>&nbsp;is
  selected, specify S3 bucket for the target storage, and click
  <strong>Next.</strong>
</p>
<p>
  <img src="https://help.split.io/hc/article_attachments/360042904051/Screen_Shot_2019-11-12_at_2.16.33_PM.png" alt="Screen_Shot_2019-11-12_at_2.16.33_PM.png" />
</p>
<p>
  4. Select the IAM Role needed to access the service, consult with AWS expert
  for more info, in this example, we used a role that has
  <strong>AmazonKinesisFullAccess</strong> policy, click
  <strong>Next&nbsp;</strong>then click <strong>Create delivery stream.</strong>
</p>
<p>
  5. The Second service needed is AWS Lambda, select
  <strong>AWS-&gt;Lambda, </strong>click on <strong>Create function</strong> button,
  choose <strong>Author from scratch&nbsp;</strong>option, use
  <strong>Java 8</strong> for runtime engine.
</p>
<p>
  <img src="https://help.split.io/hc/article_attachments/360042167091/Screen_Shot_2019-11-04_at_9.53.12_AM.png" alt="Screen_Shot_2019-11-04_at_9.53.12_AM.png" />
</p>
<p>
  6. Next step is to create the Java code for Lambda service, we will use
  <strong>Eclipse Maven</strong> project with the following dependencies:
</p>
<pre class="p1"><span class="s2">&lt;</span><strong>dependency</strong><span class="s2">&gt;</span><br /><span class="Apple-converted-space">&nbsp;&nbsp; </span><span class="s2">&lt;</span><span class="s3"><strong>groupId</strong></span><span class="s2">&gt;</span>com.amazonaws<span class="s2">&lt;/</span><span class="s3"><strong>groupId</strong></span><span class="s2">&gt;</span><br /><span class="Apple-converted-space">&nbsp;&nbsp; </span><span class="s2">&lt;</span><span class="s3"><strong>artifactId</strong></span><span class="s2">&gt;</span>aws-lambda-java-core<span class="s2">&lt;/</span><span class="s3"><strong>artifactId</strong></span><span class="s2">&gt;</span><br /><span class="s1"><span class="Apple-converted-space">&nbsp;&nbsp; </span></span><span class="s2">&lt;</span><strong>version</strong><span class="s2">&gt;</span><span class="s1">1.0.0</span><span class="s2">&lt;/</span><strong>version</strong><span class="s2">&gt;</span><br /><span class="s2">&lt;/</span><strong>dependency</strong><span class="s2">&gt;</span><br /><span class="s2">&lt;</span><strong>dependency</strong><span class="s2">&gt;</span><br /><span class="Apple-converted-space">&nbsp;  </span><span class="s2">&lt;</span><span class="s3"><strong>groupId</strong></span><span class="s2">&gt;</span>com.amazonaws<span class="s2">&lt;/</span><span class="s3"><strong>groupId</strong></span><span class="s2">&gt;</span><br /><span class="Apple-converted-space">&nbsp; &nbsp;</span><span class="s2">&lt;</span><span class="s3"><strong>artifactId</strong></span><span class="s2">&gt;</span>aws-java-sdk-core<span class="s2">&lt;/</span><span class="s3"><strong>artifactId</strong></span><span class="s2">&gt;</span><br /><span class="Apple-converted-space">&nbsp; &nbsp;</span><span class="s2">&lt;</span><span class="s3"><strong>version</strong></span><span class="s2">&gt;</span>1.11.671<span class="s2">&lt;/</span><span class="s3"><strong>version</strong></span><span class="s2">&gt;</span><br /><span class="s2">&lt;/</span><strong>dependency</strong><span class="s2">&gt;</span><br /><span class="s2">&lt;</span><strong>dependency</strong><span class="s2">&gt;</span><br /><span class="Apple-converted-space">&nbsp; &nbsp; </span><span class="s2">&lt;</span><span class="s3"><strong>groupId</strong></span><span class="s2">&gt;</span>com.amazonaws<span class="s2">&lt;/</span><span class="s3"><strong>groupId</strong></span><span class="s2">&gt;</span><br /><span class="Apple-converted-space">&nbsp; &nbsp; </span><span class="s2">&lt;</span><span class="s3"><strong>artifactId</strong></span><span class="s2">&gt;</span>amazon-kinesis-client<span class="s2">&lt;/</span><span class="s3"><strong>artifactId</strong></span><span class="s2">&gt;</span><br /><span class="Apple-converted-space">&nbsp; &nbsp; </span><span class="s2">&lt;</span><span class="s3"><strong>version</strong></span><span class="s2">&gt;</span>1.11.2<span class="s2">&lt;/</span><span class="s3"><strong>version</strong></span><span class="s2">&gt;</span><br /><span class="s1"><span class="Apple-converted-space">&nbsp;</span></span><span class="s2">&lt;/</span><strong>dependency</strong><span class="s2">&gt;</span><br /><span class="s1"><span class="Apple-converted-space">&nbsp;</span></span><span class="s2">&lt;</span><strong>dependency</strong><span class="s2">&gt;</span><br /><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s2">&lt;</span><strong>groupId</strong><span class="s2">&gt;</span><span class="s1">org.json</span><span class="s2">&lt;/</span><strong>groupId</strong><span class="s2">&gt;</span><br /><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s2">&lt;</span><strong>artifactId</strong><span class="s2">&gt;</span><span class="s1">json</span><span class="s2">&lt;/</span><strong>artifactId</strong><span class="s2">&gt;</span><br /><span class="s1"><span class="Apple-converted-space">&nbsp; &nbsp; </span></span><span class="s2">&lt;</span><strong>version</strong><span class="s2">&gt;</span><span class="s1">20180813</span><span class="s2">&lt;/</span><strong>version</strong><span class="s2">&gt;</span><br /><span class="s2">&lt;/</span><strong>dependency</strong><span class="s2">&gt;</span></pre>
<p>
  7. Insert the code below in the class (the class name here is
  <strong>WebhookConsumer.java</strong>), make sure to replace the
  <strong>awsAccessKey</strong>, <strong>awsSecretKey</strong>,
  <strong>fireHoseDeliveryStreamName</strong> and
  <strong>Regions.US-EAST-2</strong>. The code below will convert the JSON structure
  passed from the POST request to Dictionary objects, then loop through each Impression
  block to send it to Kinesis service.
</p>
<pre class="p1"><span class="s1">package</span> splitsupport<span class="s2">;</span><br /><span class="s1">import</span> java<span class="s2">.</span>nio<span class="s2">.</span>ByteBuffer<span class="s2">;</span><br /><span class="s1">import</span> java<span class="s2">.</span>util<span class="s2">.</span>ArrayList<span class="s2">;</span><br /><span class="s1">import</span> java<span class="s2">.</span>util<span class="s2">.</span>HashMap<span class="s2">;</span><br /><span class="s1">import</span> java<span class="s2">.</span>util<span class="s2">.</span>List<span class="s2">;</span><br /><span class="s1">import</span> java<span class="s2">.</span>util<span class="s2">.</span>Map<span class="s2">;<br /></span><span class="s1">import</span> org<span class="s2">.</span>json<span class="s2">.</span>JSONObject<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>auth<span class="s2">.</span>AWSStaticCredentialsProvider<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>auth<span class="s2">.</span>BasicSessionCredentials<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>regions<span class="s2">.</span>Regions<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>services<span class="s2">.</span>kinesisfirehose<span class="s2">.</span>AmazonKinesisFirehose<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>services<span class="s2">.</span>kinesisfirehose<span class="s2">.</span>AmazonKinesisFirehoseClientBuilder<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>services<span class="s2">.</span>kinesisfirehose<span class="s2">.</span>model<span class="s2">.</span>PutRecordRequest<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>services<span class="s2">.</span>kinesisfirehose<span class="s2">.</span>model<span class="s2">.</span>PutRecordResult<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>services<span class="s2">.</span>kinesisfirehose<span class="s2">.</span>model<span class="s2">.</span>Record<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>services<span class="s2">.</span>lambda<span class="s2">.</span>runtime<span class="s2">.</span>Context<span class="s2">;</span><br /><span class="s1">import</span> com<span class="s2">.</span>amazonaws<span class="s2">.</span>services<span class="s2">.</span>lambda<span class="s2">.</span>runtime<span class="s2">.</span>RequestHandler<span class="s2">;</span><br /><br /><span class="s1">public</span><span class="s3"> </span><span class="s1">class</span><span class="s3"> </span>WebhookConsumer<span class="s3"> </span><span class="s1">implements</span><span class="s3"> </span><span class="s4">RequestHandler</span><span class="s2">&lt;</span><span class="s5">Object</span><span class="s2">,</span><span class="s3"> </span><span class="s5">String</span><span class="s2">&gt;</span><span class="s3"><span class="Apple-converted-space">&nbsp; </span></span><span class="s6">\{</span><br /><em>@Override</em><br /><span class="s1"><span class="Apple-tab-span"> </span></span><span class="s2">public</span><span class="s1"> </span><span class="s3">String</span><span class="s1"> </span>handleRequest<span class="s4">(</span><span class="s3">Object</span><span class="s1"> </span><span class="s5">input</span><span class="s6">,</span><span class="s1"> </span><span class="s7">Context</span><span class="s1"> </span><span class="s5">context</span><span class="s4">)</span><span class="s1"> </span><span class="s4">\{</span><br /><span class="s1"><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span></span><span class="s3">String</span><span class="s1"> </span>treatment<span class="s6">=</span><span class="s8">""</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span><span class="s2">try</span> <span class="s4">\{</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">     </span></span><span class="s3">String</span><span class="s1"> </span><span class="s9">awsAccessKey</span><span class="s6">=</span>"XXXXXXXX"<span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">     </span></span><span class="s3">String</span><span class="s1"> </span><span class="s9">awsSecretKey</span><span class="s6">=</span>"xxxxxxxxxxxxxxxxxxxxxx"<span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">     </span></span><span class="s3">String</span><span class="s1"> </span>fireHoseDeliveryStreamName<span class="s6">=</span><span class="s8">"SplitImpressions"</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">     </span></span><span class="s3">BasicSessionCredentials</span><span class="s1"> </span><span class="s9">awsCredentials</span><span class="s1"> </span><span class="s6">=</span><span class="s1"> </span><span class="s2">new</span><span class="s1"> </span><span class="s10">BasicSessionCredentials</span><span class="s4">(</span>awsAccessKey<span class="s6">,</span><span class="s1"> </span>awsSecretKey<span class="s4">)</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">     </span></span><span class="s7">AmazonKinesisFirehose</span><span class="s1"> </span><span class="s9">firehoseClient</span><span class="s1"> </span><span class="s6">=</span><span class="s1"> </span>AmazonKinesisFirehoseClientBuilder<span class="s6">.</span><span class="s11"><em>standard</em></span><span class="s4">()</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">      </span></span><span class="s6">.</span>withCredentials<span class="s4">(</span><span class="s2">new</span><span class="s1"> </span>AWSStaticCredentialsProvider<span class="s4">(</span><span class="s12">awsCredentials</span><span class="s4">))</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">      </span></span><span class="s6">.</span>withRegion<span class="s4">(</span><span class="s13"><em>Regions</em></span><span class="s6">.</span><span class="s14"><strong><em>US_EAST_2</em></strong></span><span class="s4">)</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">      </span><span class="s6">.</span><span class="s10">build</span><span class="s4">()</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp;   </span></span><span class="s7">List</span><span class="s6">&lt;</span><span class="s7">Map</span><span class="s6">&lt;</span>String<span class="s1"> </span><span class="s6">,</span><span class="s1"> </span>String<span class="s6">&gt;&gt;</span><span class="s1"> </span><span class="s9">impressions</span><span class="s1"> </span><span class="s6">=</span><span class="s1"> </span><span class="s11"><em>StringToHash</em></span><span class="s4">(</span><span class="s5">input</span><span class="s6">.</span><span class="s15">toString</span><span class="s4">())</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp;   </span></span><span class="s2">for</span><span class="s1"> </span><span class="s4">(</span><span class="s7">Map</span><span class="s6">&lt;</span>String<span class="s6">,</span><span class="s1"> </span>String<span class="s6">&gt;</span><span class="s1"> </span><span class="s9">imp1</span><span class="s1"> </span><span class="s6">:</span><span class="s1"> </span><span class="s12">impressions</span><span class="s4">)</span><span class="s1"> </span><span class="s4">\{</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span><span class="s3">JSONObject</span><span class="s1"> </span>messageJson<span class="s1"> </span><span class="s6">=</span><span class="s1"> </span><span class="s2">new</span><span class="s1"> </span><span class="s10">JSONObject</span><span class="s4">()</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span>messageJson<span class="s6">.</span><span class="s10">put</span><span class="s4">(</span><span class="s8">"key"</span><span class="s6">,</span><span class="s1"> </span>imp1<span class="s6">.</span><span class="s16">get</span><span class="s4">(</span><span class="s8">"key"</span><span class="s4">))</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span>messageJson<span class="s6">.</span><span class="s10">put</span><span class="s4">(</span><span class="s8">"split"</span><span class="s6">,</span><span class="s1"> </span>imp1<span class="s6">.</span><span class="s16">get</span><span class="s4">(</span><span class="s8">"split"</span><span class="s4">))</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span><span class="s12">messageJson</span><span class="s6">.</span><span class="s10">put</span><span class="s4">(</span>"environmentName"<span class="s6">,</span><span class="s1"> </span><span class="s12">imp1</span><span class="s6">.</span><span class="s16">get</span><span class="s4">(</span>"environmentName"<span class="s4">))</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span>messageJson<span class="s6">.</span><span class="s10">put</span><span class="s4">(</span><span class="s8">"time"</span><span class="s6">,</span><span class="s1"> </span>imp1<span class="s6">.</span><span class="s16">get</span><span class="s4">(</span><span class="s8">"time"</span><span class="s4">))</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span>messageJson<span class="s6">.</span><span class="s10">put</span><span class="s4">(</span><span class="s8">"label"</span><span class="s6">,</span><span class="s1"> </span>imp1<span class="s6">.</span><span class="s16">get</span><span class="s4">(</span><span class="s8">"label"</span><span class="s4">))</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span><span class="s12">messageJson</span><span class="s6">.</span><span class="s10">put</span><span class="s4">(</span>"treatment"<span class="s6">,</span><span class="s1"> </span><span class="s12">imp1</span><span class="s6">.</span><span class="s16">get</span><span class="s4">(</span>"treatment"<span class="s4">))</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span>PutRecordRequest<span class="s1"> </span><span class="s9">putRecordRequest</span><span class="s1"> </span><span class="s6">=</span><span class="s1"> </span><span class="s2">new</span><span class="s1"> </span><span class="s10">PutRecordRequest</span><span class="s4">()</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span>putRecordRequest<span class="s6">.</span><span class="s10">setDeliveryStreamName</span><span class="s4">(</span>fireHoseDeliveryStreamName<span class="s4">)</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span><span class="s3">System</span><span class="s6">.</span><span class="s14"><strong><em>out</em></strong></span><span class="s6">.</span>print<span class="s4">(</span><span class="s12">messageJson</span><span class="s6">.</span>toString<span class="s4">())</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span><span class="s3">Record</span><span class="s1"> </span><span class="s9">record</span><span class="s1"> </span><span class="s6">=</span><span class="s1"> </span><span class="s2">new</span><span class="s1"> </span>Record<span class="s4">()</span><span class="s6">.</span>withData<span class="s4">(</span><span class="s17">ByteBuffer</span><span class="s6">.</span><span class="s11"><em>wrap</em></span><span class="s4">(</span><span class="s12">messageJson</span><span class="s6">.</span>toString<span class="s4">()</span><span class="s6">.</span>getBytes<span class="s4">()))</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span>putRecordRequest<span class="s6">.</span><span class="s10">setRecord</span><span class="s4">(</span>record<span class="s4">)</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">        </span></span><span class="s3">PutRecordResult</span><span class="s1"> </span><span class="s18">putRecordResult</span><span class="s1"> </span><span class="s6">=</span><span class="s1"> </span>firehoseClient<span class="s6">.</span><span class="s16">putRecord</span><span class="s4">(</span>putRecordRequest<span class="s4">)</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="s12">treatment</span><span class="s6">=</span><span class="s8">"Success"</span><span class="s6">;</span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-tab-span"> </span></span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span">     </span><span class="s4">\}</span><br /><span class="s1"><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span></span><span class="s4">\}</span><span class="s1"> </span><span class="s2">catch</span><span class="s1"> </span><span class="s4">(</span>Exception<span class="s1"> </span><span class="s9">e</span><span class="s4">)</span><span class="s1"> </span><span class="s4">\{</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp;   </span></span><span class="s3">System</span><span class="s6">.</span><span class="s14"><strong><em>out</em></strong></span><span class="s6">.</span>print<span class="s4">(</span><span class="s8">"Exception: "</span><span class="s6">+</span><span class="s12">e</span><span class="s6">.</span>getMessage<span class="s4">())</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp;   </span></span><span class="s2">return</span><span class="s1"> </span>"Exception: "<span class="s6">+</span><span class="s12">e</span><span class="s6">.</span><span class="s10">getMessage</span><span class="s4">()</span><span class="s6">;</span><br /><span class="Apple-converted-space">  </span><span class="s4">\}</span><br /><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s2">return</span><span class="s1"> </span>treatment<span class="s6">;</span><br /><span class="s4"> \}</span><br /> public<span class="s1"> </span>static<span class="s1"> </span><span class="s7">List</span><span class="s6">&lt;</span><span class="s7">Map</span><span class="s6">&lt;</span><span class="s19">String</span><span class="s1"> </span><span class="s6">,</span><span class="s1"> </span><span class="s19">String</span><span class="s6">&gt;&gt;</span><span class="s1"> </span><span class="s20">StringToHash</span><span class="s4">(</span><span class="s3">String</span><span class="s1"> </span><span class="s5">decomp</span><span class="s4">)</span><span class="s1"> </span><span class="s4">\{</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span></span><span class="s7">List</span><span class="s6">&lt;</span><span class="s7">Map</span><span class="s6">&lt;</span>String<span class="s1"> </span><span class="s6">,</span><span class="s1"> </span>String<span class="s6">&gt;&gt;</span><span class="s1"> </span><span class="s9">arrayRecord</span><span class="s1"><span class="Apple-converted-space">&nbsp; </span></span><span class="s6">=</span><span class="s1"> </span><span class="s2">new</span><span class="s1"> </span><span class="s10">ArrayList</span><span class="s6">&lt;</span><span class="s7">Map</span><span class="s6">&lt;</span>String<span class="s6">,</span>String<span class="s6">&gt;&gt;</span><span class="s4">()</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span></span><span class="s2">if</span><span class="s1"> </span><span class="s4">(</span><span class="s5">decomp</span><span class="s6">.</span>contains<span class="s4">(</span><span class="s8">"\}, \{"</span><span class="s4">))</span><span class="s1"> </span><span class="s4">\{</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span><span class="s2">for</span><span class="s4">(</span><span class="s2">final</span> <span class="s3">String</span> <span class="s9">entry</span> <span class="s6">:</span> <span class="s5">decomp</span><span class="s6">.</span><span class="s10">split</span><span class="s4">(</span><span class="s8">"\},"</span><span class="s4">))</span> <span class="s4">\{</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span></span><span class="s7">Map</span><span class="s6">&lt;</span>String<span class="s6">,</span>String<span class="s6">&gt;</span><span class="s1"> </span><span class="s9">oneRecord</span><span class="s1"> </span><span class="s6">=</span><span class="s1"> </span><span class="s2">new</span><span class="s1"> </span><span class="s10">HashMap</span><span class="s6">&lt;</span>String<span class="s6">,</span><span class="s1"> </span>String<span class="s6">&gt;</span><span class="s4">()</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; </span><span class="s2">for</span><span class="s4">(</span><span class="s2">final</span> <span class="s3">String</span> <span class="s9">parts</span> <span class="s6">:</span> <span class="s12">entry</span><span class="s6">.</span><span class="s10">split</span><span class="s4">(</span><span class="s8">","</span><span class="s4">))</span> <span class="s4">\{</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; <span class="Apple-tab-span"> </span></span><span class="s2">final</span> <span class="s3">String</span><span class="s4">\[\]</span> <span class="s9">record</span> <span class="s6">=</span> <span class="s12">parts</span><span class="s6">.</span><span class="s10">split</span><span class="s4">(</span><span class="s8">"="</span><span class="s4">)</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; <span class="Apple-tab-span"> </span></span><span class="s3">String</span> <span class="s9">recordOne</span> <span class="s6">=</span> <span class="s12">record</span><span class="s4">\[</span><span class="s21">0</span><span class="s4">\]</span><span class="s6">.</span><span class="s10">replace</span><span class="s4">(</span><span class="s8">"\[\{"</span><span class="s6">,</span> <span class="s8">""</span><span class="s4">)</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; <span class="Apple-tab-span"> </span></span></span>recordOne<span class="s1"> </span><span class="s6">=</span><span class="s1"> </span>recordOne<span class="s6">.</span><span class="s10">replace</span><span class="s4">(</span><span class="s8">"\{"</span><span class="s6">,</span><span class="s1"> </span><span class="s8">""</span><span class="s4">)</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; <span class="Apple-tab-span"> </span></span><span class="s3">String</span> <span class="s9">recordTwo</span> <span class="s6">=</span> <span class="s12">record</span><span class="s4">\[</span><span class="s21">1</span><span class="s4">\]</span><span class="s6">.</span><span class="s10">replace</span><span class="s4">(</span><span class="s8">"\}\]"</span><span class="s6">,</span> <span class="s8">""</span><span class="s4">)</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; </span></span>oneRecord<span class="s6">.</span><span class="s16">put</span><span class="s4">(</span>recordOne<span class="s6">.</span><span class="s10">trim</span><span class="s4">()</span><span class="s6">,</span><span class="s1"> </span>recordTwo<span class="s6">.</span><span class="s10">trim</span><span class="s4">())</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp;</span><span class="s4">\}</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp;</span></span>arrayRecord<span class="s6">.</span><span class="s16">add</span><span class="s4">(</span>oneRecord<span class="s4">)</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span><span class="s4">\}</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="s4">\}</span> <span class="s2">else</span> <span class="s4">\{</span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="Apple-converted-space">&nbsp; </span></span><span class="s7">Map</span><span class="s6">&lt;</span>String<span class="s6">,</span>String<span class="s6">&gt;</span><span class="s1"> </span><span class="s9">oneRecord</span><span class="s1"> </span><span class="s6">=</span><span class="s1"> </span><span class="s2">new</span><span class="s1"> </span><span class="s10">HashMap</span><span class="s6">&lt;</span>String<span class="s6">,</span><span class="s1"> </span>String<span class="s6">&gt;</span><span class="s4">()</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp;</span><span class="s2">for</span><span class="s4">(</span><span class="s2">final</span> <span class="s3">String</span> <span class="s9">parts</span> <span class="s6">:</span> <span class="s5">decomp</span><span class="s6">.</span><span class="s10">split</span><span class="s4">(</span><span class="s8">","</span><span class="s4">))</span> <span class="s4">\{</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; <span class="Apple-tab-span"> </span></span><span class="s2">final</span> <span class="s3">String</span><span class="s4">\[\]</span> <span class="s9">record</span> <span class="s6">=</span> <span class="s12">parts</span><span class="s6">.</span><span class="s10">split</span><span class="s4">(</span><span class="s8">"="</span><span class="s4">)</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; <span class="Apple-tab-span"> </span></span><span class="s3">String</span> <span class="s9">recordOne</span> <span class="s6">=</span> <span class="s12">record</span><span class="s4">\[</span><span class="s21">0</span><span class="s4">\]</span><span class="s6">.</span><span class="s10">replace</span><span class="s4">(</span><span class="s8">"\[\{"</span><span class="s6">,</span> <span class="s8">""</span><span class="s4">)</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; <span class="Apple-tab-span"> </span></span><span class="s3">String</span> <span class="s9">recordTwo</span> <span class="s6">=</span> <span class="s12">record</span><span class="s4">\[</span><span class="s21">1</span><span class="s4">\]</span><span class="s6">.</span><span class="s10">replace</span><span class="s4">(</span><span class="s8">"\}\]"</span><span class="s6">,</span> <span class="s8">""</span><span class="s4">)</span><span class="s6">;</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp; </span></span>oneRecord<span class="s6">.</span><span class="s16">put</span><span class="s4">(</span>recordOne<span class="s6">.</span><span class="s10">trim</span><span class="s4">()</span><span class="s6">,</span><span class="s1"> </span>recordTwo<span class="s6">.</span><span class="s10">trim</span><span class="s4">())</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp;  </span><span class="s4">\}</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-converted-space">&nbsp; &nbsp;</span></span>arrayRecord<span class="s6">.</span><span class="s16">add</span><span class="s4">(</span>oneRecord<span class="s4">)</span><span class="s6">;</span><br /><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> <span class="s4">\}</span><br /><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span> </span><span class="s2">return</span><span class="s1"> </span>arrayRecord<span class="s6">;</span><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span></span><br /><span class="Apple-tab-span"> </span><span class="s4">\}</span><br />\}</pre>
<p class="p4">
  <span class="s4">8. Export a self-contained JAR file for your project, in&nbsp; Eclipse, right-click on the project name and select <strong>Export</strong>.</span>
</p>
<p>
  <img src="https://help.split.io/hc/article_attachments/360042163952/Screen_Shot_2019-11-04_at_10.22.25_AM.png" alt="Screen_Shot_2019-11-04_at_10.22.25_AM.png" />
</p>
<p class="p4">
  <span class="s4">9. Select <strong>Runnable JAR File</strong> option and click <strong>Next,&nbsp;</strong>then specify the JAR file name and click <strong>Finish.</strong></span>
</p>
<p class="p4">
  <span class="s4"><strong><img src="https://help.split.io/hc/article_attachments/360042164292/Screen_Shot_2019-11-04_at_10.23.32_AM.png" alt="Screen_Shot_2019-11-04_at_10.23.32_AM.png" /></strong></span>
</p>
<p class="p4">
  <span class="s4">10. Back to AWS Lambda page, under <strong>Function code</strong>&nbsp;section, update the <strong>Handler&nbsp;</strong>box with the content below:</span>
</p>
<pre class="p4"><span class="s4">splitsupport.WebhookConsumer::handleRequest</span></pre>
<p class="p4">
  <span class="s4">Then upload the new created JAR file.</span>
</p>
<p class="p4">
  <span class="s4"><img src="https://help.split.io/hc/article_attachments/360042169611/Screen_Shot_2019-11-04_at_10.32.44_AM.png" alt="Screen_Shot_2019-11-04_at_10.32.44_AM.png" /></span>
</p>
<p>
  11. The Third service needed is the API Gateway, select
  <strong>Services-&gt;API Gateway.</strong>
</p>
<p>
  12. Click on <strong>Create API&nbsp;</strong>button, and use
  <strong>Rest API </strong>and <strong>New API</strong> options, type a name for
  your API service and click <strong>Create API.</strong>
</p>
<p>
  <img src="https://help.split.io/hc/article_attachments/360042155412/Screen_Shot_2019-11-04_at_8.56.46_AM.png" alt="Screen_Shot_2019-11-04_at_8.56.46_AM.png" />
</p>
<p>
  13. Click on your new created API Service, click
  <strong>Actions&nbsp;</strong>list to add <strong>POST </strong>Method Execution,
  select <strong>Lambda Function</strong> for
  <strong>Integration type&nbsp;</strong>and type the Lambda function name created
  previously.
</p>
<p>
  <img src="https://help.split.io/hc/article_attachments/360042165632/Screen_Shot_2019-11-04_at_10.41.31_AM.png" alt="Screen_Shot_2019-11-04_at_10.41.31_AM.png" />
</p>
<p>
  14. Since Split zip the post body when calling the Webhook, we need to enable
  binary type for our API Gateway, under <strong>Settings,&nbsp;</strong>add */*
  in <strong>Binary Media Types</strong> and click
  <strong>Save Changes.</strong>
</p>
<p>
  <strong><img src="https://help.split.io/hc/article_attachments/360042171011/Screen_Shot_2019-11-04_at_10.46.55_AM.png" alt="Screen_Shot_2019-11-04_at_10.46.55_AM.png" /></strong>
</p>
<p>
  15. The last step is to create a Stage for your API Gateway, and generate the
  webhook URL under <strong>Stages&nbsp;</strong>page, click the
  <strong>Create</strong> button.
</p>
<p>
  <img src="https://help.split.io/hc/article_attachments/360042171391/Screen_Shot_2019-11-04_at_10.50.04_AM.png" alt="Screen_Shot_2019-11-04_at_10.50.04_AM.png" />
</p>
<p>
  16. Your Webhook service is ready now, login to the Split user interface, go
  to <strong>Admin Settings&nbsp;</strong>page, click on
  <strong>Integrations,&nbsp;</strong>and click <strong>Add&nbsp;</strong>button
  for <strong>Outgoing Webhook (Impressions) .</strong>
</p>
<p>
  17. Select which environment's impressions to export, and paste the API Gateway
  URL, and click <strong>Save.</strong>
</p>
<p>
  <strong><img src="https://help.split.io/hc/article_attachments/15728309069197" alt="Screen_Shot_2023-05-12_at_12.04.22_PM.png" /></strong>
</p>