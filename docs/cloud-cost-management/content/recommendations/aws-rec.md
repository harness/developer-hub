import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import RedirectIfStandalone from '@site/src/components/DynamicMarkdownSelector/RedirectIfStandalone';

<RedirectIfStandalone label="AWS" targetPage="/docs/cloud-cost-management/get-started/dynamic-get-started" />


## AWS Recommendations

<Tabs>
<TabItem value="ec2" label="EC2 Recommendations">

### Before You Begin
- Ensure that you have enabled the **Resource Inventory Management** feature enabled when creating a cloud connector.
- You must add the required permissions and enable EC2 recommendations in AWS. If you are an existing customer, you need to:
    - Add `ce:GetRightsizingRecommendation` permission to the `HarnessEventsMonitoringPolicy` in your AWS Connector's IAM role
    - In AWS Cost Explorer > Preferences, enable "Receive Amazon EC2 resource recommendations" and "Recommendations for linked accounts"
- Enable CPU and Memory Metrics: 
    - **CPU Metrics**: CloudWatch has to be enabled for the AWS account.
    - **Memory Metrics**: CloudWatch agent has to be installed on every EC2 instance.

:::info
You can use the external metrics ingestion feature in AWS to configure the AWS Compute Optimizer to ingest EC2 memory utilization metrics from observability products like Datadog, Dynatrace, Instana, and New Relic. In this case, EC2 recommendation will be generated by taking account of Memory metrics as well along with CPU metrics.
:::

--------

## Types of EC2 Recommendations
- **Instance Resizing:** CCM recommends resizing your instance within the same instance family or using a different instance family based on instance usage. For information about the different instance families in AWS, go to Available instance types.

- **Decommissioning:** The instance is terminated or decommissioned if not in use for a long time.

--------

## How are EC2 Recommendations computed?

Harness CCM provides EC2 recommendations by integrating directly with AWS services:

- **Data Source**: Recommendations are fetched directly from AWS Cost Explorer APIs rather than being computed natively by Harness. These recommendations do not factor in Reserved Instance (RI) or Savings Plan (SP) discounts you may already have
- **Analysis Method**: AWS analyzes historical CPU and memory utilization patterns of your EC2 instances to generate optimization suggestions
- **Savings Calculations**: Based on AWS EC2 Recommendations methodology, which compares current instance costs against recommended instance costs. For more details, see [Savings Calculations](https://docs.aws.amazon.com/cost-management/latest/userguide/understanding-rr-calc.html#savings-calc)

-------

### Recommendation Drilldown

 <DocImage path={require('../static/ec-rec-one.gif')} width="90%" height="90%" title="Click to view full size image" />

- **Potential Monthly Spend**: Projected cost if recommendation is applied
- **Potential Monthly Savings**: Expected monthly cost reduction
- **Configuration Comparison**: A detailed table comparing current and recommended configurations for:
    - **Instance Family**: The category of EC2 instance types that share similar hardware configurations but vary in size. 
    - **CPU (vCPU)**: The number of virtual CPU cores allocated to the instance. 
    - **Memory (GiB)**: The amount of RAM available to the instance, measured in gibibytes. 
    - **CPU Utilization**: The percentage of allocated compute capacity being used by your instance over the analyzed period. 
    - **Memory Utilization**: The percentage of allocated memory being used by your instance. 
    - **Region**: The AWS region where the EC2 instance is located.
    - **Potential Monthly Cost**: Calcuted on On-demand cost

 <DocImage path={require('../static/ec-rec-two.gif')} width="90%" height="90%" title="Click to view full size image" />

- **EC2 Details**: Resource metadata including any associated tags
- **CPU and Memory Utilization Graph**: Visual representation of historical resource usage
- **Tune Recommendations**: This section allows you to customize how EC2 recommendations are generated based on your specific requirements. A default preset has been applied to your account via recommendation references, which may result in some fields being disabled or set to custom values. The tuning parameter for EC2 recommendations is the instance family scope:
  - **Within the same instance family**: When selected, recommendations will only suggest instance types from the same family as your current instance (e.g., if you're using a t3 instance, only other t3 instances will be recommended).
  - **Across instance families**: When selected, recommendations can suggest any suitable instance type across all AWS instance families.
  These settings can be saved as presets for consistent application across your organization's recommendations. See [Manage Presets](/docs/cloud-cost-management/use-ccm-cost-optimization/ccm-recommendations/home-recommendations#added-functionalities)

</TabItem>
<TabItem value="ecs" label="ECS Recommendations">

### Before You Begin
- To obtain ECS recommendations, configure an AWS CCM Connector with the Inventory Management feature enabled.

- No Delegate setup is required. All utilization metrics are obtained using a cross account IAM role. See [Set Up Cloud Cost Management for AWS](/docs/cloud-cost-management/get-started/#aws).

-----

## Types of ECS Recommendations

ECS recommendations have one primary type: **Service Resizing**. This recommendation analyzes your ECS service's CPU and memory utilization patterns and suggests optimized resource configurations to eliminate waste while maintaining appropriate performance levels. Service Resizing helps you right-size your container definitions based on actual workload requirements, reducing costs without compromising reliability.

-----

## How are ECS Recommendations computed?

Harness CCM computes ECS recommendations by analyzing historical CPU and memory utilization patterns of your services. Here's how the process works:

- **Service Analysis**: Recommendations analyze past utilization metrics for ECS workloads (called services)
- **Coverage**: Supports both AWS Fargate and EC2 spot instances
- **Methodology**: Uses histogram-based statistical analysis for accurate recommendations
- **Default Buffer**: Automatically adds a 15% safety buffer to recommended resources

### Data Collection Process

When you enable Cost Visibility for your ECS cluster:

1. **Metric Collection**: Harness collects CPU and memory utilization metrics for every service in the cluster at one-minute intervals
2. **Data Aggregation**: The Delegate aggregates this data over 20-minute windows before sending to Harness
3. **Data Processing**:
   - **CPU**: Partial histograms for each 20-minute window are sent and later merged
   - **Memory**: Maximum value is sent as a single data point per window
   - These data points are used to compute the complete histograms displayed in the UI

### Recommendation Calculation

- **Equal Weighting**: Each daily histogram receives equal weightage in the analysis (e.g., selecting 30 days of data means each day has equal importance)
- **Customization**: You can tune recommendations by adjusting the percentage buffer for CPU and memory requests
- **Fargate Compatibility**: For AWS Fargate, recommendations are rounded to the nearest available predefined configuration values. For more information, see [AWS Fargate Task Definitions](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html)

## Categorization

The recommendations are categorized as the following:

- Cost Optimized
- Performance Optimized

### Cost Optimized

The cost-optimized recommendations are computed as follows:

- The lower bound is based on the **50th percentiles** of CPU samples and memory peaks.
- There is no upper bound for CPU samples and memory peaks are based on the **95th percentile**.
- It is recommended not to set the upper bound for the CPU samples, because the CPU is considered a compressible resource.
- There is no limit set for the CPU to avoid throttling of services when there is a spike in CPU usage.
- The potential monthly spend and savings are calculated based on the **90th percentiles** of CPU samples and memory peaks.

:::caution
Since the recommendations are computed using the 50th percentile of the CPU samples and memory peaks, this may potentially lead to system performance issues. Before using cost-optimized recommendations, ensure that you evaluate the recommendation's impact thoroughly.
:::

### Performance Optimized

The performance-optimized recommendations are computed using the **95th percentile** of CPU samples and memory peaks. Because of this, the probability of having any effect on the performance is minimum. However, the cost may go high for the resources that are optimized using this method.

The potential monthly spend and savings are calculated based on the **90th percentiles** of CPU samples and memory peaks.

### Recommendation Drilldown

 <DocImage path={require('../static/ecs-details.png')} width="90%" height="90%" title="Click to view full size image" />

The recommendation details page provides comprehensive information about potential savings and resource changes:

- **Potential Monthly Spend**: Projected cost if the recommendation is applied to your ECS service
- **Potential Monthly Savings**: Expected monthly cost reduction after implementing the recommendation
- **Resource Changes**: 
  - Displays comparison between **Current** CPU/Memory requests and **Recommended** (Cost-Optimized or Performance-Optimized) values
  - Shows exactly what configuration changes need to be made to realize the projected savings
- **Resource Utilization Histogram**: 
  - Visual representation of CPU/Memory usage patterns analyzed over your selected timeframe (7 or 30 days)
  - Helps validate recommendation accuracy by showing the actual distribution of resource usage

 <DocImage path={require('../static/ecs-tune.png')} width="90%" height="90%" title="Click to view full size image" />

The tuning section provides configuration details and customization options:

- **ECS Service Details**:
  - Displays your **Cluster** name, **Service** name, and **Launch Type** (Fargate or EC2)
  - Provides context for the recommendation based on your specific ECS configuration

- **Tune Recommendations**:
  - Customize resource allocations by adding a **buffer percentage** to CPU/Memory values
  - Use the interactive slider to increase or decrease buffer percentage based on your risk tolerance
  - Default buffer is set to 0% (recommendations use exact calculated values)
  - All resource recommendations automatically adjust based on your selected buffer



</TabItem>
<TabItem value="governance" label="Governance Recommendations">

## Governance Recommendations

Governance recommendations help you implement best practices for managing your AWS resources according to your organization's policies and compliance requirements.

To see all AWS Governance recommendations, [See here](/docs/cloud-cost-management/use-ccm-cost-governance/asset-governance/aws/aws-recommendations)


### AWS Resource Coverage (Examples)

- EC2 instances
- S3 buckets
- Lambda functions
- RDS (Relational Database Service) instances
- CloudFormation stacks

For a comprehensive list of all supported AWS resources, refer to the [AWS Resource Reference — Cloud Custodian documentation.](https://cloudcustodian.io/docs/aws/resources/index.html)

</TabItem>
</Tabs>