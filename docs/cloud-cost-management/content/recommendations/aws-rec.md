import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import RedirectIfStandalone from '@site/src/components/DynamicMarkdownSelector/RedirectIfStandalone';

<RedirectIfStandalone label="AWS" targetPage="/docs/cloud-cost-management/get-started/dynamic-get-started" />



## AWS Recommendations

<Tabs>
<TabItem value="ec2" label="EC2 Recommendations">

### Before You Begin
- Ensure that you have enabled the **Resource Inventory Management** feature enabled when creating a cloud connector.
- You must add the required permissions and enable EC2 recommendations in AWS. If you are an existing customer, you need to:
    - Add `ce:GetRightsizingRecommendation` permission to the `HarnessEventsMonitoringPolicy` in your AWS Connector's IAM role
    - In AWS Cost Explorer > Preferences, enable "Receive Amazon EC2 resource recommendations" and "Recommendations for linked accounts"
- Enable CPU and Memory Metrics: 
    - **CPU Metrics**: CloudWatch has to be enabled for the AWS account.
    - **Memory Metrics**: CloudWatch agent has to be installed on every EC2 instance.

:::info
You can use the external metrics ingestion feature in AWS to configure the AWS Compute Optimizer to ingest EC2 memory utilization metrics from observability products like Datadog, Dynatrace, Instana, and New Relic. In this case, EC2 recommendation will be generated by taking account of Memory metrics as well along with CPU metrics.
:::

--------

## Types of EC2 Recommendations
- **Instance Resizing:** CCM recommends resizing your instance within the same instance family or using a different instance family based on instance usage. For information about the different instance families in AWS, go to Available instance types.

- **Decommissioning:** The instance is terminated or decommissioned if not in use for a long time.

--------

## How are EC2 Recommendations computed?

Harness CCM provides EC2 recommendations by integrating directly with AWS services:

- **Data Source**: Recommendations are fetched directly from AWS Cost Explorer APIs rather than being computed natively by Harness. These recommendations do not factor in Reserved Instance (RI) or Savings Plan (SP) discounts you may already have
- **Analysis Method**: AWS analyzes historical CPU and memory utilization patterns of your EC2 instances to generate optimization suggestions
- **Savings Calculations**: Based on AWS EC2 Recommendations methodology, which compares current instance costs against recommended instance costs. For more details, see [Savings Calculations](https://docs.aws.amazon.com/cost-management/latest/userguide/understanding-rr-calc.html#savings-calc)

-------

## Recommendation Drilldown

<DocVideo src="https://app.tango.us/app/embed/89164540-a07f-4900-bca7-b303fbb37154?skipCover=false&defaultListView=false&skipBranding=false&makeViewOnly=true&hideAuthorAndDetails=true" style="min-height:720px" title="Recommendation Drilldown in Harness CCM" />

--------

### Recommendation Summary

 <DocImage path={require('../static/ec-rec-one.mp4')} width="90%" height="90%" title="Click to view full size image" />

- **Potential Monthly Spend**: Projected cost if recommendation is applied
- **Potential Monthly Savings**: Expected monthly cost reduction
- **Configuration Comparison**: A detailed table comparing current and recommended configurations for:
    - **Instance Family**: The category of EC2 instance types that share similar hardware configurations but vary in size. 
    - **CPU (vCPU)**: The number of virtual CPU cores allocated to the instance. 
    - **Memory (GiB)**: The amount of RAM available to the instance, measured in gibibytes. 
    - **CPU Utilization**: The percentage of allocated compute capacity being used by your instance over the analyzed period. 
    - **Memory Utilization**: The percentage of allocated memory being used by your instance. 
    - **Region**: The AWS region where the EC2 instance is located.
    - **Potential Monthly Cost**: Calcuted on On-demand cost

### Resource Details and Utilization

 <DocImage path={require('../static/ec-rec-two.mp4')} width="90%" height="90%" title="Click to view full size image" />


- **EC2 Details**: Resource metadata including any associated tags
- **CPU and Memory Utilization Graph**: Visual representation of historical resource usage
- **Tune Recommendations**: This section allows you to customize how EC2 recommendations are generated based on your specific requirements. A default preset has been applied to your account via recommendation references, which may result in some fields being disabled or set to custom values. The tuning parameter for EC2 recommendations is the instance family scope:
  - **Within the same instance family**: When selected, recommendations will only suggest instance types from the same family as your current instance (e.g., if you're using a t3 instance, only other t3 instances will be recommended).
  - **Across instance families**: When selected, recommendations can suggest any suitable instance type across all AWS instance families.
  These settings can be saved as presets for consistent application across your organization's recommendations. See [Manage Presets](/docs/cloud-cost-management/use-ccm-cost-optimization/ccm-recommendations/home-recommendations#added-functionalities)

-------

## FAQs

### Why aren't memory metrics displayed when using Datadog integration?

If you ingest memory metrics using Datadog integration, EC2 recommendations do consider these metrics in their calculations; however, the memory utilization data is not displayed on the EC2 Recommendation page.

This occurs because:

- The CPU and memory metrics data we retrieve is typically sourced from CloudWatch
- In this case, the metrics originate from an external source (Datadog)
- These Datadog metrics are directly integrated with AWS Compute Optimizer and are utilized in generating the recommendations
- According to AWS Compute Optimizer API documentation, they do not offer support for retrieving these external utilization metrics

As a result, while the recommendations are accurately calculated using both CPU and memory data, the memory metrics themselves will not be visible in the recommendation interface.

Read more: [External metrics ingestion](https://docs.aws.amazon.com/compute-optimizer/latest/ug/external-metrics-ingestion.html)
</TabItem>
<TabItem value="ecs" label="ECS Recommendations">

## ECS Recommendations

### Resource Details and UtilizationTypes of ECS Recommendations

ECS recommendations have one primary type: **Service Resizing**

### Resource Details and UtilizationRecommendation Options

#### Resource Details and UtilizationCost Optimized

The cost-optimized recommendations are computed as follows:

- The lower bound is based on the **50th percentiles** of CPU samples and memory peaks.
- There is no upper bound for CPU samples and memory peaks are based on the **95th percentile**.
- It is recommended not to set the upper bound for the CPU samples, because the CPU is considered a compressible resource.
- There is no limit set for the CPU to avoid throttling of services when there is a spike in CPU usage.
- The potential monthly spend and savings are calculated based on the **90th percentiles** of CPU samples and memory peaks.

:::caution
Since the recommendations are computed using the 50th percentile of the CPU samples and memory peaks, this may potentially lead to system performance issues. Before using cost-optimized recommendations, ensure that you evaluate the recommendation's impact thoroughly.
:::

#### Resource Details and UtilizationPerformance Optimized

The performance-optimized recommendations are computed using the **95th percentile** of CPU samples and memory peaks. Because of this, the probability of having any effect on the performance is minimum. However, the cost may go high for the resources that are optimized using this method.

The potential monthly spend and savings are calculated based on the **90th percentiles** of CPU samples and memory peaks.

### Resource Details and UtilizationTune Recommendations

You can tune recommendations by changing the percentage of recommended CPU and memory requests buffer.

### Resource Details and UtilizationHow are Recommendations Computed?

The recommendations are computed by analyzing the past utilization of CPU and memory of your service. ECS workloads are called services.

- ECS recommendations are computed both for AWS Fargate and EC2 spot instances.
- The implementation uses a histogram method to compute the recommendations.
- The computation adds a **15% buffer** to the recommended resources by default.
- CCM allows you to add any additional buffer using the Tune recommendations option.

#### Resource Details and UtilizationData Collection Process

When you enable Cost Visibility for your ECS cluster:

1. Harness starts collecting CPU and memory resource utilization metrics for every service present in the cluster every minute.
2. The utilization data is aggregated in the Delegate for a 20-minute window.
3. The 20-minute aggregated data is then sent to Harness:
   - **CPU**: For CPU values, a partial histogram for the last 20 minutes is sent.
   - **Memory**: The maximum value of the memory is sent as a single data point.
4. This data is used for further processing and to compute the complete histogram displayed in the UI.

#### Resource Details and UtilizationEqual Weightage Approach

Each of these daily histograms has an equal weightage for a given task. As a result, if you select the last 30 days of data to aggregate, we will assign equal weightage to each of the 30 days.

#### Resource Details and UtilizationAWS Fargate Considerations

The task definitions for AWS Fargate can only be set to predefined values. For more information, go to AWS Fargate Task Definitions. Therefore, the recommendations are rounded off to the nearest configuration available on ECS Fargate.

### Resource Details and UtilizationWhy Histogram?

A histogram is used to account for the seasonality of high resource utilization on certain days of the week. Assume your application receives a lot of traffic (and thus a lot of resource utilization) on weekends, and we are using a decaying histogram. In that case:

- If you view service recommendation on Friday and selected the last seven days of utilization data, then Saturday will be given the least weightage, followed by Sunday, hence the recommended resources will be low.
- If you view the service recommendation on Monday, Sunday will be given the most weightage, hence your recommended resources may be high.

To avoid this, we use the histogram method and give equal weight to all previous days.

</TabItem>
<TabItem value="governance" label="Governance Recommendations">

## Governance Recommendations

Governance recommendations help you implement best practices for managing your AWS resources according to your organization's policies and compliance requirements.

### Resource Details and UtilizationAvailable Governance Recommendations

Harness CCM provides various governance recommendations for AWS resources to help you maintain compliance and optimize costs.

For a complete list of supported governance recommendations, see [Asset Governance](/docs/cloud-cost-management/use-ccm-cost-governance/asset-governance/asset-governance).

### Resource Details and UtilizationKey Benefits

- Ensure compliance with organizational policies
- Identify resources that don't adhere to best practices
- Reduce security risks
- Optimize resource utilization
- Implement consistent tagging and resource management

</TabItem>
</Tabs>