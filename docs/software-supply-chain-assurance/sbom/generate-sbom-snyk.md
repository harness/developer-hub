---
title: Ingest SBOM from Snyk into SSCA
description: You can easily ingest SBOM results generated from Snyk
sidebar_position: 30
---

import CosignKeyGeneration from '/docs/software-supply-chain-assurance/shared/generate-cosign-key-pair.md';

This workflow describes how to ingest Snyk scan results into a Harness pipeline. STO supports the following scan approaches for the following Snyk products:

- Snyk Container SBOM via an ingestion workflow
- Snyk Open Source SBOM via [STO Snyk step](/docs/security-testing-orchestration/sto-techref-category/snyk/snyk-scans#snyk-repository-orchestration-example)


## Generating and ingesting a Snyk Container SBOM

A [Software Bill of Materials (SBOM)](https://cyclonedx.org/capabilities/sbom/) is a list of all the components, libraries, and other dependencies used in a software application. Harness SSCA can ingest [JSON SPDX](https://spdx.dev/learn/overview/) or [CycloneDx](https://cyclonedx.org/specification/overview/) formatted SBOM from any tool that can generate these report formats.

### Generate the keys for SBOM Attestation - optional
For enhanced trust and verification of your SBOM's integrity, the SBOM Orchestration step offers optional signing and attestation generation. This functionality requires a private key, password, and corresponding public key. If you choose to skip signing, you can proceed without generating or storing these keys.

Here's how to set these keys if you choose to enable signing

- **Generate the keys**: Begin by generating the keys using [Cosign](https://docs.sigstore.dev/signing/quickstart)
- **Securely store the keys**: Safeguard the generated private key, public key, and password by creating [Harness file secrets](https://developer.harness.io/docs/platform/secrets/add-file-secrets/) for each.

### Configure your pipeline to ingest SBOM

1. In your Harness pipeline, go to the stage where you want to ingest the SBOM, and select the **Overview** tab.
2. In **Shared Paths**, enter a path to a location where your SBOM can be stored on the build machine, such as `/shared/customer_artifacts`.

   <DocImage path={require('../../security-testing-orchestration/use-sto/static/ingesting-issues-from-other-scanners-00.png')} width="70%" height="70%" />

3. Add a step to your stage that generates an SBOM, such as a **Run**, **Plugin**, or **GitHub Action** step.

   For example, you could use the following command in a **Run** step to generate a Snyk SBOM.
   
   ```
   snyk container sbom --format=spdx2.3+json \
    ubuntu:22.04 > /shared/customer_artifacts/result.spdx.json
   ```
   <DocImage path={require('../static/ingesting-sbom-from-other-scanners-03.png')} width="50%" height="50%" />
   

4. Verify that step above is configured to output the file to one of the **Shared Paths** (i.e /shared/customer_artifacts/result.spdx.json)
5. Add an [SBOM Orchestration step](./generate-sbom.md#add-the-sbom-orchestration-step) configured to ingest the SBOM:
   * **Step Mode:** Set the step mode to **Ingestion**.
   * **SBOM File Path:** enter the path to the SBOM file generated by your SBOM tool.
   * **Source:** Set the source, which can be DockerHub, ECR, GCR, ACR or Repository. Depending on your selection, a unique set of fields will appear, each specific to the source you've chosen. Address these fields as required, this is similar to configuring the source in SBOM Orchestration step. For more details of what each field entails, please refer to the [documentation on SBOM Orchestration](./generate-sbom.md#add-the-sbom-orchestration-step). If you are using DockerHub, you can follow along.
   ***Image:**, Enter the name of your image with tag, such as `my-docker-org/repo-name:tag`.
   <details>
      <summary>Generate key pairs using Cosign for SBOM Attestation</summary>

      <CosignKeyGeneration />

   </details>

   * **Private Key (optional):** Input your Private key from the [Harness file secret](/docs/platform/secrets/add-file-secrets).

   * **Password (optional):** Input your Password for the Private key from the [Harness file secret](/docs/platform/secrets/add-file-secrets).

   <DocImage path={require('../static/ingesting-sbom-from-other-scanners-02.png')} width="50%" height="50%" />

## Generate and ingest a Snyk Open Source SBOM

### Configure the STO scan step to generate SBOM

Configure the [Snyk STO scanner step](/docs/security-testing-orchestration/sto-techref-category/snyk/snyk-code-scanning#snyk-code-scan---orchestration-mode), and make sure you select **Generate SBOM** and the **SBOM Format**.

<DocImage path={require('../static/generate-sbom-blackduck-00.png')} width="60%" height="60%" title="Click to view full size image" />

### Get the SBOM file path

The Snyk STO step creates a `JOB_ID` [output variable](/docs/continuous-integration/use-ci/run-step-settings.md#output-variables) that you can use to reference the SBOM file path in the **SBOM Orchestration** step.

1. Replace `STAGE_ID` and `STEP_ID` in the following [Harness expression](/docs/platform/variables-and-expressions/runtime-inputs.md#expressions) with the stage ID and step ID for your Snyk STO step.

   ```
   <+pipeline.stages.STAGE_ID.spec.execution.steps.STEP_ID.output.outputVariables.JOB_ID>
   ```

2. Use the expression in your SBOM file path. The exact path depends on where your scanner outputs SBOM files. For example, this filepath references a Snyk STO step with the ID `mysnykstep` in a stage with the ID `mybuildstage`:

   ```
   /addon/results/<+pipeline.stages.mybuildstage.spec.execution.steps.mysnykstep.output.outputVariables.JOB_ID>.sbom
   ```

:::tip

Alternately, you can get the output path and output variable expression from a previous run of the same pipeline. To do this, go to the execution details page, select the stage with the STO scanner step, and then select the STO scanner step. In the step's logs, you can find the output path, and you can get the output variable from the **Output** tab.

<DocImage path={require('../static/generate-sbom-blackduck-02.gif')} width="60%" height="60%" title="Click to view full size image" />

:::

## Configure the SBOM Orchestration step

Add an [SBOM Orchestration step](./generate-sbom.md#add-the-sbom-orchestration-step) configured to ingest the SBOM.

:::info
**SBOM Orchestration** step in deploy stage can only be used in the [Containerized Step Groups](/docs/continuous-delivery/x-platform-cd-features/cd-steps/containerized-steps/containerized-step-groups.md)
:::

* **Step Mode:** Set the step mode to **Ingestion**.
* **SBOM File Path:** enter the SBOM file path that uses the `JOB_ID` value, as detailed in [Get the SBOM file path](#get-the-sbom-file-path).
* **Source:** Set the source, which can be DockerHub, ECR, GCR, ACR or Repository. Depending on your selection, a unique set of fields will appear, each specific to the source you've chosen. Address these fields as required, this is similar to configuring the source in SBOM Orchestration step. For more details of what each field entails, please refer to the [documentation on SBOM Orchestration](./generate-sbom.md#add-the-sbom-orchestration-step). If you are using DockerHub, you can follow along.
* **Image:**, Enter the name of your image with tag, such as `my-docker-org/repo-name:tag`.
* **Private Key:** Select the [Harness file secret](/docs/platform/secrets/add-file-secrets) containing the private key to use to sign the attestation.
* **Password:** Select the [Harness text secret](/docs/platform/secrets/add-use-text-secrets) containing the password for the private key.

<DocImage path={require('../static/generate-sbom-blackduck-01.png')} width="50%" height="50%" title="Click to view full size image" />
