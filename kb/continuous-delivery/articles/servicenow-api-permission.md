---
description: KB - Debug ServiceNow create, update, and approval steps
title: ServiceNow create, update, and approval API permissions
---

This KB discusses the permissions required for ServiceNow create, update, and approval steps.

## Create ServiceNow tickets

### Create a ServiceNow ticket without templates

Harness uses the following API to create a ServiceNow ticket without templates:  

```
curl --location --request POST '{instance_url}/api/now/table/incident?sysparm_display_value=all' \
--header 'Authorization: Basic {bearer token}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "description" : "sample incident"
}'
```

The `instance_url` mentioned above is the ServiceNow URL provided in the ServiceNow connector.
The `bearer token` mentioned above is the token generated by the credentials provided in ServiceNow.

Required permission: `itil`.

### Create a ServiceNow ticket from a form templates

Harness uses custom script APIs to create a ticket using form templates.
Required permission: `itil`, `x_harne_harness_ap.integration_user_role`.

### Create a ServiceNow ticket from a standard templates

This is supported only for change request task types.

Harness uses custom script APIs to create a ticket using form template.
Required permission: `itil`, `x_harne_harness_ap.integration_user_role`.

## Update ServiceNow tickets 

### Update a ServiceNow ticket without templates

Harness uses the following API to update a ServiceNow ticket without templates:  

```
curl --location --request PATCH '{instance_url}/api/now/table/incident/57bea4ef1b41e150c312755e034bcbd1?sysparm_display_value=all' \
--header 'Authorization: Basic {bearer token}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "description" : "updated"
}'
```

The `instance_url` mentioned above is the ServiceNow URL provided in the ServiceNow connector.
The `bearer token` mentioned above is the token generated by the credentials provided in ServiceNow.

Required permission: `itil`.

### Update multiple ServiceNow tickets without templates

This functionality is behind the feature flag, `CDS_NG_UPDATE_MULTIPLE_SNOW_CHANGE_REQUEST`. Contact [Harness Support](mailto:support@harness.io) to enable this functionality.

### Update a ServiceNow ticket from templates

Harness uses custom script to call ServiceNow APIs to update a ticket from templates.
Required permission: `x_harne_harness_ap.integration_user_role`.

## ServiceNow Approval step

Harness uses the following API to get the fields of the ServiceNow ticket for which the approval or rejection criteria is specified in the Approval step.

```
curl --location --request GET '{instance_url}/api/now/table/incident?sysparm_display_value=all&sysparm_query=number=INC0011331' \
--header 'Authorization: Basic {bearer token}' \
```

The `instance_url` mentioned above is the ServiceNow URL provided in the ServiceNow connector.
The `bearer token` mentioned above is the token generated by the credentials provided in ServiceNow.

Required permission: `itil`.

## General debugging FAQs

1. **Why is apply from template selection blocked when using ServiceNow create/update step?**

   The connector provided is probably missing the `x_harne_harness_ap.integration_user_role` role permission. Another possible reason could be that the delegate might be down.

2. **Why does updating a ServiceNow ticket from template results in an error, `Error in fetching issue 125c716edb61a910e9748c3b13961918 .Issue does not exist`.**

   The selected ticket type might be different from the actual ticket.

3. **How to debug ACL error?**

   Assume that the integration user has all above mentioned roles for specific use cases.

   1. Identify the user or integration that Harness used as a connector. This could be a specific user, system account, or an integration like an API. 
   2. ServiceNow uses Access Control Lists (ACLs) to control what data a user can access and what they can do with that data. Check the ACLs for the table to which you are trying to insert/update. For example, Incident.
   3. Ensure that the user or integration has the necessary roles to perform the action. This might involve checking their roles, groups, or specific ACL rules. 
   4. If the user or integration does not have the necessary permissions, you will need to update the ACLs. This could involve adding a new ACL rule, or modifying an existing one.
   5. Once the ACLs are updated, create the ServiceNow ticket again. If the insert is successful, the issue has been resolved.
   6. ServiceNow has data restrictions on their UI. You can use the APIs listed above for debugging.
   7. Check if the table, for example Change Request has any scoped applications enabled. For details, go to [ServiceNow documentation](https://docs.servicenow.com/bundle/vancouver-application-development/page/build/applications/reference/r_TableApplicationAccessFields.html).
      ![image](../static/debug-approval-step.png)
   8. Check if there are any data policies written on the user's Dev instance on the table. For details, go to [ServiceNow documentation](https://docs.servicenow.com/bundle/vancouver-platform-administration/page/administer/field-administration/concept/c_DataPolicy.html).
